rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if the user is an authenticated admin.
    // This assumes you have set a custom claim { admin: true } on the user's account.
    function isAdmin() {
      return request.auth != null && request.auth.token.admin == true;
    }

    // --- Admin-Only Collections ---
    // Grant full access to admins for collections they manage.
    // The `list` permission is crucial for the admin dashboard queries to work.
    match /(admins|contactSubmissions|counters|expenses|memberships|orders|coachingApplications)/{docId} {
        allow list, read, write: if isAdmin();
    }

    // --- Publicly Readable Collections ---
    // Anyone can read these, but only admins can write to them.
    match /(products|coaches|settings|shippingOptions)/{docId} {
      allow read: if true;
      allow write: if isAdmin();
      allow list: if isAdmin(); // Admins can list these too
    }
    
    // --- Publicly Creatable Documents ---
    // Allow anyone to create documents in these collections (e.g., placing an order).
    match /orders/{orderId} {
      allow create: if true;
    }
    
    match /coachingApplications/{applicationId} {
      allow create: if true;
    }

    match /contactSubmissions/{submissionId} {
      allow create: if true;
    }
  }
}
