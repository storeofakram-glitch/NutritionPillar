rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
  
    // Helper function to check for admin custom claim
    function isAdmin() {
      return request.auth != null && request.auth.token.admin == true;
    }

    // --- Admin-Only Collections ---
    // Grant full list, read, and write access to admins for collections
    // that should not be public at all.
    match /(admins|contactSubmissions|counters|expenses|memberships|orders)/{docId=**} {
      allow list, read, write: if isAdmin();
    }

    // --- Publicly Readable Collections ---
    // Allow public read access for collections needed by website visitors.
    // Admins can still write to these.
    match /(products|coaches|settings|shippingOptions)/{docId=**} {
      allow read: if true;
      allow write: if isAdmin();
    }
    
    // --- Publicly Writable Collections ---
    // Allow anyone to create documents in these collections for things like
    // guest checkouts and contact forms. Admins can manage them.
    match /coachingApplications/{applicationId} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
  }
}
